---
title: "Draft"
subtitle: "STA 210 - Project"
author: "Bayes' Harem - Christina Wang, Kat Cottrell, David Goh, Ethan Song"
format: pdf
editor: source
editor_options: 
  markdown: 
    wrap: 72
---

```{r}
#| label: load-pkgs
#| message: false
#| warning: false
library(tidyverse)
library(tidymodels)
library(knitr)
library(ggfortify)
library(GGally)
```

```{r load-data}
#| message: false
abortion_data_full<-read_csv(here::here("data/abortion-attitudes", 
                                        "wvs-usa-abortion-attitudes-data.csv"))
```

## Introduction and Research Question

Understanding public attitudes on divisive political issues is an important way for political leaders to mobilize voters and for lawmakers to draft laws that represent their constituents. While it may be easier to poll constituents' positions on an issue, it can be challenging to assess the complex factors that influence and predict those stances. 

Abortion is one such divisive issue in the United States. Both pro-choice and pro-life groups have a history of mobilizing in states across the country in support of legislation for their respective sides (Ziegler, 2020). However, following the Supreme Court's 1973 decision in Roe v. Wade, a ruling which protected an individual’s right to have an abortion before fetal viability, the issue has risen in political salience. Both the pro-choice and pro-life movements have gained national prominence, and the two major political parties have polarized around the issue, with the Democratic Party in favor of and the Republican Party against policies legalizing and increasing access to abortion (Weinberger 2022). Abortion has also increasingly become a key issue that voters consider when making their choice at the ballot box, with an increasing share of Americans identifying as "single-issue voters" regarding abortion (Brenan 2020). 

In May 2022, a leaked draft opinion revealed that the US Supreme Court is prepared to overturn Roe v. Wade. Overturning Roe would dramatically change the trajectory of abortion politics in the US. Unless Congress passes a national policy, states would be able to decide whether or not to legalize abortion and gain much greater leverage in regulating access to the procedure (Weinberger 2022). 

Given the potential overturning of Roe and the polarizing nature of the issue, it is important to understand how the American public feels about whether abortion should be legal or not, how accessible the procedure should be, and which factors influence these opinions. Understanding public opinion on the issue will ensure that political leaders are able to mobilize the correct constituencies, and that policy experts are able to pass policies on this issue that accurately reflect the preferences of the American people.

The dataset used in this analysis observes attitudes on the justifiability of abortion among respondents in in the United States across six “waves” of the World Values Survey (1982-2011), which is administered every few years and collects information about people’s values and beliefs worldwide, alongside basic demographic characteristics. The data are collected via face-to-face interviews at the respondents’ homes. In this data set, the response variable, justifiability of abortion, is a numerical measure on a scale of 1 to 10 on the individual person’s attitude toward whether abortion is justifiable or not.  Individuals responded 1 for “abortion is never justified” and 10 for “abortion is always justified. 

Our research question is as follows: “Do an individual’s political ideology and their personal attitudes/preferences towards other issues, such as the importance of religion in their life and their respect for authority, among others, predict their attitude on the justifiability of abortion?” We will attempt to answer this question using an EDA-informed predictive model. Given that this issue has become highly polarized by political party, we predict that liberal ideology and liberal-leaning attitudes on other issues will correlate with belief that abortion is more justified.

## Exploratory Data Analysis

```{r visualization-summary}
#| warning: false
ggplot(abortion_data_full, aes(x = aj)) +
  geom_histogram(binwidth = 1, aes(y=..density..)) + 
  geom_density(color = "red") +
  labs(title = "Histogram of Abortion Attitudes",
       x = "Abortion Justifiability (1-Least, 10-Most)")

summary(abortion_data_full$aj)
```

From the above visualization of the distribution of attitudes toward the justifiability of abortion, we observe that it is not a bell shape, but rather trimodal. This is likely because the question's phrasing is similar to a yes/no question, but respondents were asked to give their level of agreement on a scale of 1-10. This may worsen the ability of a multiple linear regression (MLR) model to fit the data. Consequently, further research may choose to truncate the attitude on the justifiability of abortion into a categorical variable such as (Agree, Disagree, Undecided), conducting a binomial or multinomial logistic regression thereafter.

We now extend our exploratory data analysis (EDA) to the predictor variables of interest: year of survey, ideology, Child Autonomy Index, Importance of God, Respect for Authority, and National Pride. The EDA for each variable comprises a histogram and a boxplot of the response variable, grouped by value of the predictor. We also provide a correlation matrix to detect any multicollinearity between our predictor variables, which would increase the uncertainty of our model’s parameters. 

```{r eda-year}
#| warning: false
#Year of survey
ggplot(abortion_data_full, aes(x = year)) +
  geom_histogram() + 
  labs(title = "Histogram of year")
ggplot(abortion_data_full, aes(group = year, y = aj)) +
  geom_boxplot() 
```

```{r eda-ideology}
#| warning: false
# ideology
ggplot(abortion_data_full, aes(x = ideology)) +
  geom_histogram() + 
  labs(title = "Histogram of ideology")
ggplot(abortion_data_full, aes(x = ideology,group = ideology, y = aj)) +
  geom_boxplot()
```

```{r eda-cai}
#| warning: false
# Child autonomy index
ggplot(abortion_data_full, aes(x = cai)) +
  geom_histogram() + 
  labs(title = "Histogram of Child autonomy index")
ggplot(abortion_data_full, aes(x = cai, group = cai, y = aj)) +
  geom_boxplot()
```

```{r eda-god}
#| warning: false
# Importance of God
ggplot(abortion_data_full, aes(x = godimportant)) +
  geom_histogram() + 
  labs(title = "Histogram of how respondent saw God's importance")
ggplot(abortion_data_full, aes(x = godimportant, group = godimportant, 
                               y = aj)) +
  geom_boxplot()
```

```{r eda-respect}
#| warning: false
# Respect for authority
ggplot(abortion_data_full, aes(x = respectauthority)) +
  geom_histogram() + 
  labs(title = "Histogram of respect for authority")
ggplot(abortion_data_full, aes(x = respectauthority, group = respectauthority, 
                          y = aj)) +
  geom_boxplot()
```

```{r eda-pride}
#| warning: false
# National Pride
ggplot(abortion_data_full, aes(x = nationalpride)) +
  geom_histogram() + 
  labs(title = "Histogram of National pride")
ggplot(abortion_data_full, aes(x = nationalpride, group = nationalpride, y = aj)) +
  geom_boxplot()
```

```{r correlations}
#| warning: false
ggpairs(abortion_data_full, 
  columns = c("year", "ideology", "cai", "godimportant", "respectauthority", 
              "nationalpride"),
  columnLabels = c("year", "ideology", "child autonomy", "imptnce of God", 
                   "resp for autho", "natl pride")) +
   theme(
    axis.text.y = element_text(size = 10),
    axis.text.x = element_text(angle = 45, size = 10),
    strip.text.y = element_text(angle = 0, hjust = 0)
    )
```


\pagebreak

## Methodology

Given that our response variable, attitude towards the justifiability of abortion, is measured on a numeric scale from 1 to 10, and that there are multiple predictor variables that we suspect to be potentially related to it, we will conduct multiple linear regression (MLR) to model the effect of these predictors on the variation in abortion attitude. 

We chose to consider predictor variables that, from our exploratory data analysis (EDA), looked like they were potentially correlated with the outcome. Because the predictor variables were discrete, our EDA was presented as a series of box plots. We observed the differences in median and quartile values of abortion attitude across different predictor values, ruling out variables with no visible hint of relationship. This led to the following predictor variables: Year of survey, Political Ideology, Child Autonomy Index, Importance of God, Respect for Authority, and National Pride.

A brief note on data cleaning: many survey questions were only added from 1995 onward, and observations before 1995 have a high number of missing values; therefore, we removed the observations that were part of “generational waves” before 1995.

```{r filter-data}
abortion_data <- abortion_data_full %>% 
  filter(year >= "1995") %>%
  select(-starts_with("wave"), -starts_with("wvsccode"))

abortion_data$year <- as.factor(abortion_data$year)
abortion_data$respectauthority <- as.factor(abortion_data$respectauthority)
abortion_data$respectauthority <- factor(abortion_data$respectauthority, levels=c('0', '-1', '1'))
abortion_data$nationalpride <- as.factor(abortion_data$nationalpride)
```

## Fitting the Model

We conducted a 75%-25% data split into training and testing sets, using the seed “206”. Fitting the MLR, we obtain the following table of parameter point estimates. 


```{r splits}
set.seed(206)
abortion_split <- initial_split(abortion_data)
abortion_training <- training(abortion_split)
abortion_testing <- testing(abortion_split)
```

```{r spec}
abortion_spec <- linear_reg() %>%
  set_engine("lm")
```


```{r recipe1}
abortion_rec1 <- recipe(aj ~ year + ideology + cai + godimportant +
                        respectauthority + nationalpride,
                        data = abortion_data) %>%
  step_center(ideology) %>%
  step_dummy(all_nominal_predictors()) %>%
  step_zv(all_predictors())

abortion_rec1
```

```{r recipe2}
abortion_rec2 <- recipe(aj ~ year + godimportant,
                        data = abortion_data) %>%
  step_dummy(all_nominal_predictors()) %>%
  step_zv(all_predictors())

abortion_rec2
```

```{r recipe3}
abortion_rec3 <- recipe(aj ~ year + ideology + cai + nationalpride,
                        data = abortion_data) %>%
  step_center(ideology) %>%
  step_dummy(all_nominal_predictors()) %>%
  step_zv(all_predictors())

abortion_rec3
```


```{r workflows}
abortion_wflow1 <- workflow() %>%
  add_model(abortion_spec) %>%
  add_recipe(abortion_rec1)

abortion_wflow2 <- workflow() %>%
  add_model(abortion_spec) %>%
  add_recipe(abortion_rec2)

abortion_wflow3 <- workflow() %>%
  add_model(abortion_spec) %>%
  add_recipe(abortion_rec3)
```

```{r fit-models}
abortion_fit1 <- abortion_wflow1 %>%
  fit(data = abortion_training)
tidy(abortion_fit1) %>%
  kable(digits = 3)

abortion_fit2 <- abortion_wflow2 %>%
  fit(data = abortion_training)
tidy(abortion_fit2) %>%
  kable(digits = 3)

abortion_fit3 <- abortion_wflow3 %>%
  fit(data = abortion_training)
tidy(abortion_fit3) %>%
  kable(digits = 3)
```

[table]

Hence, our MLR model equation is as follows, where x1 is __, x2 is __, x3 is __, x4 is __, and x5 is __:

[equation in latex]

## Model Inference and Prediction

Inference: CI and HT

We will take a quick look at the 95% confidence intervals of the parameters from our fitted model, displayed in the following plots:

[plots of parameters’ .estimate against the parameter names]

```{r inference}
tidy(abortion_fit1, conf.int = TRUE) %>%
  kable(digits = 3)
```

We then proceed to our hypothesis test. As stated in our introduction, given that this issue has become highly polarized by political party, we suspect that liberal ideology and political attitudes will correlate with belief that abortion is more justified, leading to the following hypotheses:

[write out null hypothesis and alternative hypothesis]

From the p-value in our output displayed in Figure 5(?), we conclude …

Prediction:

We now consider the strength of our model in predicting the attitude toward the justifiability of abortion of a person of certain characteristics. 

For a person who [describe liberal characteristics here], our model predicts that their attitude toward the justifiability of abortion is [write what the model would predict]. 

This does/does not support our hypothesis based on contextual knowledge of this issue. 

However, calculating the R-squared and root-mean-squared-error (RMSE) values of our model shows that our model is not very strong at predicting attitude toward the justifiability of abortion, with a R^2 of __ and RMSE of __:

[R^2, RMSE output]


```{r predict}
abortion_training_pred1 <- predict(abortion_fit1, abortion_training) %>%
  bind_cols(abortion_training %>% select(aj, year, ideology, cai, 
                                         godimportant, respectauthority, 
                                         nationalpride))
abortion_training_pred1
```


We will discuss potential reasons for this lackluster performance in our model diagnosis and conclusion sections; however, we will first conduct model evaluation and comparison to ascertain if our chosen model is still a better fit to the data compared to some alternatives. 

A quick glance at our data might seem that the models are not that strong at predicting the abortion attitude (aj) of a given observation. We will look into this further now with cross-validation, then a test in AIC and BIC statistics.

## Model Evaluation

To see how well our model fits the data on the attitudes toward the justifiability of abortion, we conducted a 10-fold cross-validation, calculating various metrics – the Akaike information criterion (AIC), Bayesian Information Criterion (BIC) and adjusted R-squared value – to evaluate the performance of our model on 10 subsets of our data. 

We also compared this to two alternative models that used other combinations of predictors from the data set. 

[3 line plots, displaying AIC, BIC and R^2 value respectively, against Fold number. Each plot should have the line graph for each of the 3 models we used)

```{r cv}
set.seed(206)
folds <- vfold_cv(abortion_training, v = 10)
abortion_fit_rs1 <- abortion_wflow1 %>%
  fit_resamples(folds)

abortion_fit_rs2 <- abortion_wflow2 %>%
  fit_resamples(folds)

abortion_fit_rs3 <- abortion_wflow3 %>%
  fit_resamples(folds)
```

```{r cv-table}
cv_metrics1 <- collect_metrics(abortion_fit_rs1, summarize = FALSE) 
cv_metrics2 <- collect_metrics(abortion_fit_rs2, summarize = FALSE) 
cv_metrics3 <- collect_metrics(abortion_fit_rs3, summarize = FALSE) 

cv_metrics1 %>%
  mutate(.estimate = round(.estimate, 3)) %>%
  pivot_wider(id_cols = id, names_from = .metric, values_from = .estimate) %>%
  kable(col.names = c("Fold", "RMSE", "R-squared"))

cv_metrics2 %>%
  mutate(.estimate = round(.estimate, 3)) %>%
  pivot_wider(id_cols = id, names_from = .metric, values_from = .estimate) %>%
  kable(col.names = c("Fold", "RMSE", "R-squared"))

cv_metrics3 %>%
  mutate(.estimate = round(.estimate, 3)) %>%
  pivot_wider(id_cols = id, names_from = .metric, values_from = .estimate) %>%
  kable(col.names = c("Fold", "RMSE", "R-squared"))
```

```{r aic-bic}
glance(abortion_fit1) %>% 
  select(AIC, BIC)

glance(abortion_fit2) %>% 
  select(AIC, BIC)

glance(abortion_fit3) %>% 
  select(AIC, BIC)
```

From the above AIC and BIC values, we have evidence that our chosen model is the strongest model and best fit for the data compared to two alternatives with fewer predictors. Our model has the lowest AIC and BIC values, which are usually penalized for having more predictors, but in this case the model is strong enough to overcome that penalty.

## Model Diagnosis

Conditions check

Linearity [residual plot vs fitted values]

Randomness

Independence [residual plot vs id]

## Conclusion + Discussion

[paste here after finalizing the google doc]

## Data dictionary

The data dictionary can be found [here](ADD%20LINK!!!).

## References

Brenan, M. (2020, July 7). One in Four Americans Consider Abortion a Key
Voting Issue. Gallup.
https://news.gallup.com/poll/313316/one-four-americans-consider-abortion-key-voting-issue.aspx

Weinberger, J. (2022, May 6). How we got here: Roe v. Wade from 1973 to
today. Vox.
https://www.vox.com/23055389/roe-v-wade-timeline-abortion-overturn-political-polarization

Ziegler, M. (2020, October 22). Abortion politics polarized before Roe.
When it's gone, the fighting won't stop. The Washington Post.
https://www.washingtonpost.com/outlook/2020/10/22/roe-polarize-abortion-politics/
