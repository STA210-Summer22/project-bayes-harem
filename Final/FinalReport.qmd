---
title: "Investigating Predictors for American Attitudes on Justifiability of Abortion"
subtitle: "STA 210 - Project"
author: "Bayes' Harem - Christina Wang, Kat Cottrell, David Goh, Ethan Song"
format: pdf
editor: source
editor_options: 
  markdown: 
    wrap: 72
---

```{r}
#| label: load-pkgs
#| message: false
#| warning: false
#| echo: false
library(tidyverse)
library(tidymodels)
library(knitr)
library(ggfortify)
library(GGally)
library(cowplot)
library(readr)
```

```{r load-data}
#| message: false
#| echo: false
abortion_data_full<-read_csv(here::here("data/abortion-attitudes", 
                                        "wvs-usa-abortion-attitudes-data.csv"))
```

```{r clean-data}
#| echo: false
abortion_data <- abortion_data_full %>% 
  filter(year >= "1995") %>%
  select(-starts_with("wave"), -starts_with("wvsccode"))
```

```{r make-factor}
#| echo: false
abortion_data$year <- as.factor(abortion_data$year)
abortion_data$respectauthority <- as.factor(abortion_data$respectauthority)
abortion_data$respectauthority <- factor(abortion_data$respectauthority, levels=c('0', '-1', '1'))
abortion_data$nationalpride <- as.factor(abortion_data$nationalpride)
```

## Introduction and Research Question

Understanding public attitudes on divisive political issues is an
important way for political leaders to mobilize voters and for lawmakers
to draft laws that represent their constituents. While it may be easier
to poll constituents' positions on an issue, it can be challenging to
assess the complex factors that influence and predict those stances.

Abortion is one such divisive issue in the United States. Both
pro-choice and pro-life groups have a history of mobilizing in states
across the country in support of legislation for their respective sides
(Ziegler, 2020). However, following the Supreme Court's 1973 decision in
Roe v. Wade, a ruling which protected an individual's right to have an
abortion before fetal viability, the issue has risen in political
salience. Both the pro-choice and pro-life movements have gained
national prominence, and the two major political parties have polarized
around the issue, with the Democratic Party in favor of and the
Republican Party against policies legalizing and increasing access to
abortion (Weinberger 2022). Abortion has also increasingly become a key
issue that voters consider when making their choice at the ballot box,
with an increasing share of Americans identifying as "single-issue
voters" regarding abortion (Brenan 2020).

In May 2022, a leaked draft opinion revealed that the US Supreme Court
is prepared to overturn Roe v. Wade. Overturning Roe would dramatically
change the trajectory of abortion politics in the US. Unless Congress
passes a national policy, states would be able to decide whether or not
to legalize abortion and gain much greater leverage in regulating access
to the procedure (Weinberger 2022).

Given the potential overturning of Roe and the polarizing nature of the
issue, it is important to understand how the American public feels about
whether abortion should be legal or not, how accessible the procedure
should be, and which factors influence these opinions. Understanding
public opinion on the issue will ensure that political leaders are able
to mobilize the correct constituencies, and that policy experts are able
to pass policies on this issue that accurately reflect the preferences
of the American people.

The dataset used in this analysis observes attitudes on the
justifiability of abortion among respondents in in the United States
across six "waves" of the World Values Survey (1982-2011), which is
administered every few years and collects information about people's
values and beliefs worldwide, alongside basic demographic
characteristics. The data are collected via face-to-face interviews at
the respondents' homes. In this data set, the response variable,
justifiability of abortion, is a numerical measure on a scale of 1 to 10
on the individual person's attitude toward whether abortion is
justifiable or not. Individuals responded 1 for "abortion is never
justified" and 10 for "abortion is always justified.

Our research question is as follows: "Do an individual's political
ideology and their personal attitudes/preferences towards other issues,
such as the importance of religion in their life and their respect for
authority, among others, predict their attitude on the justifiability of
abortion?" We will attempt to answer this question using an EDA-informed
predictive model. Given that this issue has become highly polarized by
political party, we predict that liberal ideology and liberal-leaning
attitudes on other issues will correlate with belief that abortion is
more justified.

## Exploratory Data Analysis

```{r visualization-summary}
#| warning: false
#| echo: false
ggplot(abortion_data, aes(x = aj)) +
  geom_histogram(binwidth = 1, aes(y=..density..), fill = "light blue") + 
  geom_density(color = "red") +
  labs(title = "Histogram of Abortion Attitudes",
       x = "Abortion Justifiability (1-Least, 10-Most)")
```

From the above visualization of the distribution of attitudes toward the
justifiability of abortion, we observe that it is not a bell shape, but
rather trimodal. This may be because the question's phrasing is similar
to a yes/no question, but respondents were asked to give their level of
agreement on a scale of 1-10. This may worsen the ability of a multiple
linear regression (MLR) model to fit the data. Consequently, further
research may choose to truncate the attitude on the justifiability of
abortion into a categorical variable such as (Agree, Disagree,
Undecided), conducting a binomial or multinomial logistic regression
thereafter.

We now extend our exploratory data analysis (EDA) to the predictor
variables of interest: year of survey, ideology, Child Autonomy Index,
Importance of God, Respect for Authority, and National Pride. The EDA
for each variable comprises a histogram and a boxplot of the response
variable, grouped by value of the predictor. We also provide a
correlation matrix to detect any multicollinearity between our predictor
variables, which would increase the uncertainty of our model's
parameters.

```{r eda-histograms}
#| warning: false
#| message: false
#| echo: false
h1 <- ggplot(abortion_data, aes(x = year)) +
  geom_bar(fill = "orange") + 
  labs(x = "Year of Survey")

h2 <- ggplot(abortion_data, aes(x = ideology)) +
  geom_histogram(fill = "orange") +
  labs(x = "Political Ideology")

h3 <- ggplot(abortion_data, aes(x = cai)) +
  geom_histogram(fill = "orange") +
  labs(x = "Child Autonomy Index")

h4 <- ggplot(abortion_data, aes(x = godimportant)) +
  geom_histogram(fill = "orange") +
  labs(x = "Importance of God")

h5 <- ggplot(abortion_data, aes(x = respectauthority)) +
  geom_bar(fill = "orange") +
  labs(x = "Respect for Authority")

h6 <- ggplot(abortion_data, aes(x = nationalpride)) +
  geom_bar(fill = "orange") +
  labs(x = "National Pride")

title1 <- ggdraw() + 
  draw_label(
    "Distributions of Predictor variables",
    x = 0,
    hjust = 0
  ) +
  theme(
    plot.margin = margin(0, 0, 0, 7)
  )

top_row1 <- plot_grid(h1,h2,h3, ncol = 3, nrow = 1)
bottom_row1 <- plot_grid(h4,h5,h6, ncol = 3, nrow = 1)
plot_grid(title1, top_row1, bottom_row1, 
          ncol = 1, rel_heights = c(0.1, 1,1))
# ADD CAPTION
```

```{r eda-boxplots}
#| warning: false
#| echo: false
b1 <- ggplot(abortion_data, aes(x = year, group = year, y = aj)) +
  geom_boxplot() +
  labs(y = "Abortion Attitude", x = "Year of Survey ")

b2 <- ggplot(abortion_data, aes(x = ideology,group = ideology, y = aj)) +
  geom_boxplot()+
  labs(y = "Abortion Attitude", x = "Political Ideology")

b3 <- ggplot(abortion_data, aes(x = cai, group = cai, y = aj)) +
  geom_boxplot()+
  labs(y = "Abortion Attitude", x = "Child Autonomy Index")

b4 <- ggplot(abortion_data, 
             aes(x = godimportant, group = godimportant, y = aj)) +
  geom_boxplot()+
  labs(y = "Abortion Attitude", x = "Importance of God")

b5 <- ggplot(abortion_data, aes(x = respectauthority, group = respectauthority, 
                          y = aj)) +
  geom_boxplot()+
  labs(y = "Abortion Attitude", x = "Respect For Authority")

b6 <- ggplot(abortion_data, aes(x = nationalpride, group = nationalpride, 
                          y = aj)) +
  geom_boxplot()+
  labs(y = "Abortion Attitude", x = "National Pride")

plot_grid(b1, b2, b3, b4, b5, b6, ncol = 3, nrow = 2)

# ADD TITLE AND CAPTION
```

```{r correlations}
#| warning: false
#| echo: false
ggpairs(abortion_data, 
  columns = c("year", "ideology", "cai", "godimportant", "respectauthority", "nationalpride"),
  columnLabels = c("YS", "PI", "CAI", "IG", 
                   "RA", "NP")) +
   theme(
    axis.text.y = element_text(size = 8),
    axis.text.x = element_text(angle = 45, size = 9),
    strip.text.y = element_text(angle = 0, hjust = 0)
    )
# ADD TITLE AND CAPTION
```

\pagebreak

## Methodology

Given that our response variable, attitude towards the justifiability of
abortion, is measured on a numeric scale from 1 to 10, and that there
are multiple predictor variables being tested against the null
hypothesis, we will conduct multiple linear regression (MLR) to model
the effect of these predictors on the variation in abortion attitudes.

We chose to consider the predictor variables our exploratory data
analysis (EDA) suggested were potentially correlated with the response
variable. Because the predictor variables were discrete, our EDA was
presented as a series of box plots. We observed the differences in
median and quartile values of abortion attitude across different
predictor values, ruling out variables with no significant influence on
the outcome. This led to the following predictor variables: Year of
survey, Political Ideology, Child Autonomy Index, Importance of God,
Respect for Authority, and National Pride.

Many survey questions were only added from 1995 onward, so observations before 1995 have a high number of missing values. For these reasons, observations prior to 1995 were removed.

Year of survey, Respect for Authority, and National Pride were changed
into factors since they are categorical variables. Year has 4 levels
(one corresponding to each year), Respect for Authority has 3 levels (0
being the baseline - neutral, -1 being respect for authority bad, and 1
being respect for authority good), and National Pride is a binary (0
being the baseline - having no feelings of national pride, and 1 being
having feelings of national pride) Political Ideology, Child Autonomy
Index, and Importance of God had numerical sample spaces and were
therefore treated as numerical variables.

## Fitting the Model

We conducted a 75% - 25% data split into training and testing sets,
using the random seed $206$.

```{r splits}
#| echo: false
#| warning: false
set.seed(206)
abortion_split <- initial_split(abortion_data)
abortion_training <- training(abortion_split)
abortion_testing <- testing(abortion_split)
```

```{r spec}
#| echo: false
#| warning: false
abortion_spec <- linear_reg() %>%
  set_engine("lm")
```

```{r recipe1}
#| echo: false
#| warning: false
abortion_rec <- recipe(aj ~ year + ideology + cai + godimportant +
                        respectauthority + nationalpride,
                        data = abortion_data) %>%
  step_center(ideology) %>%
  step_dummy(all_nominal_predictors()) %>%
  step_zv(all_predictors())
```

```{r recipe2}
#| echo: false
abortion_rec2 <- recipe(aj ~ year + godimportant,
                        data = abortion_data) %>%
  step_dummy(all_nominal_predictors()) %>%
  step_zv(all_predictors())
```

```{r recipe3}
#| echo: false
abortion_rec3 <- recipe(aj ~ year + ideology + cai + nationalpride,
                        data = abortion_data) %>%
  step_center(ideology) %>%
  step_dummy(all_nominal_predictors()) %>%
  step_zv(all_predictors())
```

```{r workflows}
#| echo: false
abortion_wflow <- workflow() %>%
  add_model(abortion_spec) %>%
  add_recipe(abortion_rec)

abortion_wflow2 <- workflow() %>%
  add_model(abortion_spec) %>%
  add_recipe(abortion_rec2)

abortion_wflow3 <- workflow() %>%
  add_model(abortion_spec) %>%
  add_recipe(abortion_rec3)
```

```{r fit-models}
#| echo: false
abortion_fit <- abortion_wflow %>%
  fit(data = abortion_training)

abortion_fit2 <- abortion_wflow2 %>%
  fit(data = abortion_training)

abortion_fit3 <- abortion_wflow3 %>%
  fit(data = abortion_training)
```

Fitting the MLR, we obtain the following table of parameter point
estimates.

```{r display-model}
#| echo: false
tidy(abortion_fit) %>%
  kable(digits = 3)
```

Hence, our MLR model equation is

$$\begin{aligned}y ~=~ &6.596 ~+~ 0.468x_1 ~+~ 0.33x_2 ~+~ 0.339x_3 ~+~ 0.521x_4 ~+~ 0.14x_5 \\
&~-~ (0.28x_6 ~+~ 0.287x_7 ~+~ 0.179x_8 ~+~ 0.11x_9)\end{aligned}$$

where $x_1 ~=~ \text{child autonomy index}$, $x_2 ~=~ \text{year 1999}$,
$x_3 ~=~ \text{year 2006}$, $x_4 ~=~ \text{year 2011}$,
$x_5 ~=~ \text{respect authority -1}$, $x_6 ~=~ \text{ideology}$,
$x_7 ~=~ \text{God important}$, $x_8 ~=~ \text{respect authority 1}$,
and $x_9 ~=~ \text{national pride}$.

## Model Inference and Prediction

We will take a quick look at the 95% **confidence intervals** of the
parameters from our fitted model, displayed in the following plots:

```{r ci}
#| echo: false
df <- tidy(abortion_fit, conf.int = TRUE)
intercept <- df[1,]
PI_IG <- df[c(2,4),]
CAI <- df[3,]
YS <- df[c(5,6,7),]
RA_NP <- df[c(8,9,10),]

p1 <- ggplot(intercept, aes(x = term, y = estimate, ymin = conf.low, 
                            ymax = conf.high)) +
  geom_pointrange() +
  labs(x = NULL)

p2 <- ggplot(YS, aes(x = term, y = estimate, ymin = conf.low, ymax = conf.high)) +
  geom_pointrange() +
  labs(x = NULL) +
  scale_x_discrete(labels=c("1999", "2006", "2011"))

p3 <- ggplot(CAI, aes(x = term, y = estimate, ymin = conf.low, ymax = conf.high)) +
  geom_pointrange()+
  labs(x = NULL)+
  scale_x_discrete(labels=c("Child Autonomy Index"))

p4 <- ggplot(PI_IG, aes(x = term, y = estimate, ymin = conf.low, ymax = conf.high)) +
  geom_pointrange()+
  labs(x = NULL) +
  scale_x_discrete(breaks=c("ideology","godimportant"),
        labels=c("Ideology", "Importance God"))

p5 <- ggplot(RA_NP, aes(x = term, y = estimate, ymin = conf.low, ymax = conf.high)) +
  geom_pointrange()+
  labs(x = NULL) +
  scale_x_discrete(breaks=c("respectauthority_X.1", "respectauthority_X1", "nationalpride_X1"),
        labels=c("RA=No", "RA=Yes", "NP=Yes"))

title_factor <- ggdraw() + 
  draw_label(
    "Confidence Intervals of Estimated Model Parameters (Factors)",
    x = 0,
    hjust = 0
  ) +
  theme(
    plot.margin = margin(0, 0, 0, 7)
  )

title_numeric <- ggdraw() + 
  draw_label(
    "Confidence Intervals of Estimated Model Parameters (Numeric)",
    x = 0,
    hjust = 0
  ) +
  theme(
    plot.margin = margin(0, 0, 0, 7)
  )

top_row <- plot_grid(p2,p5, ncol = 2, nrow = 1)
bottom_row <- plot_grid(p1,p3,p4, ncol = 3, nrow = 1)
plot_grid(title_factor, top_row, title_numeric, bottom_row, 
          ncol = 1, rel_heights = c(0.1, 1,0.1,1))
#ADD CAPTION
```

We then proceed to our **hypothesis test**. As stated in our
introduction, given that this issue has become highly polarized by
political party, we suspect that liberal political ideology and
political attitudes will correlate with belief that abortion is more
justified.

We define the following as liberal political ideology and attitudes: -
ideology: values closer to 1 (most left-leaning) - cai: values closer to
2 (belief in child self-determination and independence) - godimportant:
values closer to 1 (belief that God is not important) -
respectauthority: -1 (belief that greater respect for authority is a bad
thing) - nationalpride: 0 (not proud to be American)

This leads to the following hypotheses:

$H_0$ (null hypothesis): An individual's political ideology (ideology),
their beliefs about child autonomy (cai), the importance of God in their
life (godimportant), their view on whether respect for authority is good
(respectauthority), and their pride in being American (nationalpride)
are not significant predictors of aj, and the variables' respective
slope point estimates will be 0.

$H_A$ (alternative hypothesis): An individual's political ideology
(ideology), their beliefs about child autonomy (cai), the importance of
God in their life (godimportant), their view on whether respect for
authority is good (respectauthority), and their pride in being American
(nationalpride) are significant predictors of aj, and the variables'
respective slope point estimates will not be 0.

Looking at the p-values in our output displayed above, we can reject the
null hypothesis for the predictors political ideology, child autonomy index, and importance of God, as
the p-values are very small, way below the 0.05 significance threshold.
Hence, we can conclude that the data provide convincing evidence that an
individual's political ideology, beliefs about child autonomy, and the
importance of God in their life are significant predictors of their
abortion attitudes.

However, we fail to reject the null hypothesis for the predictors
respect for authority and national pride, as the p-values for each level of
these predictors are above the 0.05 significance threshold. Hence, we
cannot conclude that the data provide convincing evidence that an
individual's view on respect for authority and their pride in being
American are significant predictors of their abortion attitudes.

We now consider the strength of our model in **predicting** the attitude
toward the justifiability of abortion of a person of certain
characteristics.

Earlier, we guessed that liberal ideology and liberal-leaning attitudes
on other social issues will correlate with belief that abortion is more
justified. For a person surveyed in 2011 who identifies with a left
leaning political ideology ("1"), has a high child autonomy index of 2,
considers God and religion unimportant ("1"), and has little respect for
authority, our our model predicts that their attitude toward the
justifiability of abortion is 9.24, that is to say, very amenable to the
justifiability of abortion. This supports our hypothesis based on
contextual knowledge of this issue.

```{r predict-new}
#| echo: false
#| eval: false
new_person <- tibble(year = "2011", ideology = 1, cai = 2, godimportant = 1, 
                     respectauthority = "-1", nationalpride = "0")
predict(abortion_fit, new_data = new_person) 

```

However, calculating the R-squared and root-mean-squared-error (RMSE)
values of our model shows that our model is not very strong at
predicting attitude toward the justifiability of abortion, with a R\^2
of 0.247 and RMSE of 2.53.

We will discuss potential reasons for this lackluster performance in our
model diagnosis and conclusion sections; however, we will first conduct
model evaluation and comparison to ascertain if our chosen model is
still a better fit to the data compared to some alternatives.

A quick glance at our data might seem that the models are not that
strong at predicting the abortion attitude (aj) of a given observation.
We will look into this further now with cross-validation, then a test in
AIC and BIC statistics.

```{r metrics}
#| echo: false
#| eval: false
#| warning: false
abortion_training_pred <- predict(abortion_fit, abortion_training) %>%
  bind_cols(abortion_training %>% select(aj, year, ideology, cai, 
                                         godimportant, respectauthority))
rsq(abortion_training_pred, 
                 truth = aj, 
                 estimate = .pred)
rmse(abortion_training_pred,
                 truth = aj,
                 estimate = .pred)
```

## Model Evaluation

To see how well our model fits the data on the attitudes toward the
justifiability of abortion, we conducted a 10-fold cross-validation,
calculating various metrics -- the Akaike information criterion (AIC),
Bayesian Information Criterion (BIC) and adjusted R-squared value -- to
evaluate the performance of our model on 10 subsets of our data.

We also compared this to two alternative models that used other
combinations of predictors from the data set.

\[3 line plots, displaying AIC, BIC and R\^2 value respectively, against
Fold number. Each plot should have the line graph for each of the 3
models we used)

```{r cv}
#| echo: false
set.seed(206)
folds <- vfold_cv(abortion_training, v = 10)
abortion_fit_rs <- abortion_wflow %>%
  fit_resamples(folds)

abortion_fit_rs2 <- abortion_wflow2 %>%
  fit_resamples(folds)

abortion_fit_rs3 <- abortion_wflow3 %>%
  fit_resamples(folds)
```

```{r cv-table}
#| echo: false
cv_metrics <- collect_metrics(abortion_fit_rs, summarize = FALSE) 
cv_metrics2 <- collect_metrics(abortion_fit_rs2, summarize = FALSE) 
cv_metrics3 <- collect_metrics(abortion_fit_rs3, summarize = FALSE) 

cv_metrics %>%
  mutate(.estimate = round(.estimate, 3)) %>%
  pivot_wider(id_cols = id, names_from = .metric, values_from = .estimate) %>%
  kable(col.names = c("Fold", "RMSE", "R-squared"))

cv_metrics2 %>%
  mutate(.estimate = round(.estimate, 3)) %>%
  pivot_wider(id_cols = id, names_from = .metric, values_from = .estimate) %>%
  kable(col.names = c("Fold", "RMSE", "R-squared"))

cv_metrics3 %>%
  mutate(.estimate = round(.estimate, 3)) %>%
  pivot_wider(id_cols = id, names_from = .metric, values_from = .estimate) %>%
  kable(col.names = c("Fold", "RMSE", "R-squared"))
```

```{r aic-bic}
#| echo: false
glance(abortion_fit) %>% 
  select(AIC, BIC)

glance(abortion_fit2) %>% 
  select(AIC, BIC)

glance(abortion_fit3) %>% 
  select(AIC, BIC)
```

From the above AIC and BIC values, we have evidence that our chosen
model is the strongest model and best fit for the data compared to two
alternatives with fewer predictors. Our model has the lowest AIC and BIC
values, which are usually penalized for having more predictors, but in
this case the model is strong enough to overcome that penalty.

## Model Diagnosis

Conditions check

Linearity \[residual plot vs fitted values\]

Randomness

Independence \[residual plot vs id\]

## Conclusion + Discussion

\[paste here after finalizing the google doc\]

## Data dictionary

The data dictionary can be found [here](ADD%20LINK!!!).

## References

Brenan, M. (2020, July 7). One in Four Americans Consider Abortion a Key
Voting Issue. Gallup.
https://news.gallup.com/poll/313316/one-four-americans-consider-abortion-key-voting-issue.aspx

Weinberger, J. (2022, May 6). How we got here: Roe v. Wade from 1973 to
today. Vox.
https://www.vox.com/23055389/roe-v-wade-timeline-abortion-overturn-political-polarization

Ziegler, M. (2020, October 22). Abortion politics polarized before Roe.
When it's gone, the fighting won't stop. The Washington Post.
https://www.washingtonpost.com/outlook/2020/10/22/roe-polarize-abortion-politics/
